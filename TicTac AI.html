<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TicTacToe</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <style type="text/css">
        #wholegame{
            height: 60em;
            width: 55em;
            background-color: burlywood;
            margin-left: 25%;
            margin-top: 5em;
            text-align: center;
        }
        .blank {
            height: 200px;
            width: 200px;
            background-color: bisque;
            border: solid .1em brown;
            display: inline-block;
        }
        .container{
            margin-left: -25%;
            margin-top: 1%;
            text-align: center;
        }
        button {
            height: 2.75em;
            width: 8em;
            margin-top: 1em;
            background-color: beige;
        }
        #winner{
            position: fixed;
            top: 25%;
            bottom: 0;
            left: 10%;
            right: 0;
            display: none;
            background-color: greenyellow;
            height: 2em;
            width: 80%;
            font-size: 4em;
        }
        #error{
            position: fixed;
            top: 25%;
            bottom: 0;
            left: 10%;
            right: 0;
            display: none;
            background-color: palevioletred;
            height: 2em;
            width: 80%;
            font-size: 4em;
        }
        #autoDraw{
            position: fixed;
            top: 25%;
            bottom: 0;
            left: 10%;
            right: 0;
            display: none;
            background-color: salmon;
            height: 2em;
            width: 80%;
            font-size: 4em;
        }
    </style>
</head>
<body>
<div id="wholegame">
    <div class="container">
        <div id="winner"></div>
        <div id="error"></div>
        <div id="autoDraw"></div>
        <h1>Tic Tac Toe</h1>
        <div class="row">
            <div id="upperLeft" class="tile blank"></div>
            <div id="upperCenter" class="tile blank"></div>
            <div id="upperRight" class="tile blank"></div>
        </div>
        <div class="row">
            <div id="middleLeft" class="tile blank"></div>
            <div id="center" class="tile blank"></div>
            <div id="middleRight" class="tile blank"></div>
        </div>
        <div class="row">
            <div id="lowerLeft" class="tile blank"></div>
            <div id="lowerCenter" class="tile blank"></div>
            <div id="lowerRight" class="tile blank"></div>
        </div>
        <button id="commit">Commit Play</button><br>
        <button id="auto">Play the House</button><br>
        <button id="startover">Start Over</button>

    </div>
</div>

<script
        src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
        crossorigin="anonymous">
</script>
<script>
    $(".tile").html("<img src='img/blank.png'>");
    var imageX = "<img src=\"img/x.png\">";
    var imageO = "<img src=\"img/O.png\">";
    var imageBlank = "<img src=\"img/blank.png\">";
    var id = "";
    var gameboardArray = [
        ["upperRight", "center", "lowerLeft"],
        ["upperCenter", "center", "lowerCenter"],
        ["upperLeft", "upperCenter", "upperRight"],
        ["lowerLeft", "lowerCenter", "lowerRight"],
        ["upperLeft", "middleLeft", "lowerLeft"],
        ["upperRight", "middleRight", "lowerRight"],
        ["upperLeft", "center", "lowerRight"],
        ["middleLeft", "center", "middleRight"]

    ];
    var gameStatusArray = [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
    ];
    var playerX = true;
    var playerO = false;
    var xInARow = 0;
    var oInARow = 0;
    var idToRevert = "";
    var XorO = "";
    var image = "";
    var housePlay = "";
    var player = "";
    var autoplaying = false;
    function arrayTheSame(array, temp) {
        for (var i = 0; i < temp.length; i++) {
            for (var j = 0; j < temp[i].length; j++) {
                if (temp[i][j] != array[i][j]) {
                    idToRevert = array[i][j];
                    return false;
                    break;
                }
            }
        }
        return true;
    }

    var tempArray = gameboardArray.map(function (arr) {
        return arr.slice();
    });
    var tempStatusArray = gameStatusArray.slice();

    var noOtherChanges = "";
    var indexMarker = 0;
    function updateGameStatus (i, j){
        if (XorO==="X"){
            if (j===0){
                indexMarker = 1;
            }
            else if(j===1) {
                indexMarker = 3;
            }
            else {
                indexMarker = 9;
            }
        }
        else {
            if (j===0){
                indexMarker = -20;
            }
            else if(j===1) {
                indexMarker = -40;
            }
            else {
                indexMarker = -80;
            }
        }
        tempStatusArray[i] += indexMarker;
    }

    function spliceXorO(id) {
        console.log("splice funciton and id is "+ id);
        for (var i = 0; i < tempArray.length; i++) {
            for (var j = 0; j < tempArray[i].length; j++) {
                if (tempArray[i][j] == id) {
                    tempArray[i].splice(j, 1, XorO);
                    updateGameStatus(i, j);
                }
            }
        }
    }
    function makeReadyForNextPlayer (id){
        xInARow = 0;
        oInARow = 0;
        gameboardArray = [];
        gameStatusArray = [];
        gameboardArray = tempArray.map(function (arr) {
            return arr.slice();
        });
        gameStatusArray = tempStatusArray.slice();

        $(id).off("click");

        if (!playerX) {
            playerX = true;
            playerO = false;
        }
        else {
            playerX = false;
            playerO = true;
        }
    }


    function doWeHaveAWinner () {
        for (var i = 0; i < tempArray.length; i++) {
            oInARow = 0;
            xInARow = 0;
            for (var j = 0; j < tempArray[i].length; j++) {
                if (tempArray[i][j] == "O") {
                    oInARow++;
                }
                if (tempArray[i][j] == "X") {
                    xInARow++;
                }
                if (oInARow == 3 || xInARow == 3) {
                    $("#winner").text(XorO + " WINS!!");
                    $("#winner").css("display", "inline");
                    console.log(tempArray);
                }
            }
        }
    }

    $(".tile").on('click', tileClick);

    function tileClick () {
        $("#winner").css("display", "none");
        $("#error").css("display", "none");
        $("#autoDraw").css("display", "none");

        XorO = "";

        if (playerX) {
            image = imageX;
            XorO = "X";
        }
        if (playerO) {
            image = imageO;
            XorO = "O";
        }
        noOtherChanges = arrayTheSame(gameboardArray, tempArray);

        if (!noOtherChanges) {

            idToRevert = "#" + idToRevert;
            $(idToRevert).html(imageBlank);
            tempArray = [];

            tempArray = gameboardArray.map(function (arr) {
                return arr.slice();
            });
            tempStatusArray = gameStatusArray.slice();

        }

        id = $(this).attr("id");
        spliceXorO(id); // splice the clicked tile into the temp Array
        $(this).html(image);
        doWeHaveAWinner();
    }


    $("#commit").click(function () {

        id = "#" + id;
        if ((id.indexOf("##") != -1) || arrayTheSame(gameboardArray, tempArray)) {
            $("#error").text("You must make a selection first");
            $("#error").css("display", "inline");
        }
        else {
            makeReadyForNextPlayer(id);
            if (autoplaying) {
                autoplay();
            }
        }
    });

    function defense() {
        if(housePlay==="X"){
            for (var d = 0; d < gameStatusArray.length; d++){
                if (gameStatusArray[d]== -120){  //play in i0
                    id = gameboardArray[d][0];
                    console.log("Defense and id is "+id);
                    spliceXorO(id);
                    return true;
                    break;
                }
                else if (gameStatusArray[d] == -100){
                    console.log("100");
                    id = gameboardArray[d][1];
                    console.log("Defense and id is "+id);
                    spliceXorO(id);
                    return true;
                    break;
                    //play in i1
                }
                else if (gameStatusArray[d]== -60){
                    id = gameboardArray[d][2];
                    console.log("Defense and id is "+id);
                    spliceXorO(id);
                    return true;
                    break;
                    //play in i2
                }
            }
        }
        else {
            for (var d = 0; d < gameStatusArray.length; d++) {
                if (gameStatusArray[d] == 12) {
                    id = gameboardArray[d][0];
                    console.log("Defense and id is "+id);
                    spliceXorO(id);
                    return true;
                    break;
                    // /play in i0
                }
                else if (gameStatusArray[d] == 10) {
                    //play in i1
                    id = gameboardArray[d][1];
                    console.log("Defense and id is "+id);
                    spliceXorO(id);
                    return true;
                    break;
                }
                else if (gameStatusArray[d] == 4) {
                    //play in i2
                    id = gameboardArray[d][2];
                    console.log("Defense and id is "+id);
                    spliceXorO(id);
                    return true;
                    break;
                }
            }
        }
        return false;
    }

    function goForTheWin () {
        if (housePlay === "X") {
            for (var i = 0; i < gameStatusArray.length; i++) {
                if (gameStatusArray[i] === 12) {  //play in i0
                    id = gameboardArray[i][0];
                    spliceXorO(id);
                    return true;
                    break;
                }
                if (gameStatusArray[i] === 10) {  //play in i1
                    id = gameboardArray[i][1];
                    spliceXorO(id);
                    return true;
                    break;
                }
                if (gameStatusArray[i] === 4) {  //play in i2
                    id = gameboardArray[i][2];
                    spliceXorO(id);
                    return true;
                    break;
                }
            }
        }
        else {
            for (var i = 0; i < gameStatusArray.length; i++) {
                if (gameStatusArray[i] === -120) {  //play in i0
                    id = gameboardArray[i][0];
                    spliceXorO(id);
                    return true;
                    break;
                }
                if (gameStatusArray[i] === -100) {  //play in i1
                    id = gameboardArray[i][1];
                    spliceXorO(id);
                    return true;
                    break;
                }
                if (gameStatusArray[i] === -60) {  //play in i2
                    id = gameboardArray[i][2];
                    spliceXorO(id);
                    return true;
                    break;
                }
            }
            console.log("goforwin and id is "+id);
        }
        return false;
    }

    function goForTwoInaRow () {
        if (housePlay === "X") {
            for (var i = 0; i < gameStatusArray.length; i++) {
                if ((gameStatusArray[i] === 9) || (gameStatusArray === 3)) {  //play in i0
                    id = gameboardArray[i][0];
                    console.log("TwoinARow and id is "+id);
                    spliceXorO(id);
                    return true;
                    break;
                }
                if (gameStatusArray[i] === 1) {  //play in i2
                    id = gameboardArray[i][2];
                    console.log("TwoinARow and id is "+id);
                    spliceXorO(id);
                    return true;
                    break;
                }
            }
        }
        else {
            for (var i = 0; i < gameStatusArray.length; i++) {
                if ((gameStatusArray[i] === -80) || (gameStatusArray === -40)) {  //play in i0
                    id = gameboardArray[i][0];
                    console.log("TwoinARow and id is "+id);
                    spliceXorO(id);
                    return true;
                    break;
                }
                if (gameStatusArray[i] === -20) {  //play in i2
                    id = gameboardArray[i][2];
                    console.log("TwoinARow and id is "+id);
                    spliceXorO(id);
                    return true;
                    break;
                }
            }
        }
        return false;
    }

    function startNewRow () {
        var idReview = "";
        loop1:
            for (var i = 0; i < gameStatusArray.length; i++) {
//            console.log ("loop 1 and i is "+ i);
                if (gameStatusArray[i] === 0) {  // is the row(index) empty?
//                    console.log ("loop 1 and i is empty i is"+ i);
                    loop2:    for (var j = 0; j<3; j++){
                        idReview = gameboardArray[i][j];// if it is empty, let's look at all the id's in the row
                        console.log ("loop 2 and j is "+ j+ " and looking at id "+idReview);
                        loop3:    for (var k=0; k<gameStatusArray.length; k++){ // were going to look at all the other rows
//                            console.log ("loop 3 and k is "+ k);
                            if (gameStatusArray[k]!==0){  // if a row is not empty (zero)..
//                                console.log ("loop 3 and k is 0 at "+ k);
                                loop4: for (var l = 0; l<3; l++) {
//                                    console.log ("loop 4 and l is "+ l + " and kl is " +gameboardArray[k][l]);
                                    if (gameboardArray[k][l] === idReview) { // we check if our id is also in this nonEmpty row
//                                        console.log ("loop 4 and kl is idReview"+ gameboardArray[k][l]);
                                        break loop3; // if we find a match, don't play this spot
                                    }
                                }
                            }
                        }
                    }
//                    console.log ("we have a winner"+ i + j);
                    id = gameboardArray[i][j-1];
                    console.log("startANewRow and id is "+id);
                    spliceXorO(id);
                    return true;
                    break loop1;
                }
            }
        return false;
    }

    function playToaDraw () {
        for (var i = 0; i < gameStatusArray.length; i++) {
            if ((gameStatusArray[i] === -77) || (gameboardArray[i]=== -31)) {  //play in i0
                id = gameboardArray[i][0];
                console.log("playtoDraw and id is "+id);
                spliceXorO(id);
                return true;
                break;
            }
            if ((gameStatusArray[i] === -11) || (gameStatusArray === -79)) {  //play in i1
                id = gameboardArray[i][1];
                console.log("playtoDraw and id is "+id);
                spliceXorO(id);
                return true;
                break;
            }
            if ((gameStatusArray[i] === -39) || (gameStatusArray === -17)) {  //play in i2
                id = gameboardArray[i][2];
                console.log("playtoDraw and id is "+id);
                spliceXorO(id);
                return true;
                break;
            }
        }
    }

    function autoplay() {
        $("#autoDraw").css("display", "none");
        console.log("autoplay going");
        id = "";
        if (housePlay == "X") {
            XorO = "X";
            image = imageX;
        }
        else if (housePlay == "O") {
            XorO = "O";
            image = imageO;
        }
        else{}
        if (gameboardArray[0][1] === "center") {
            id = "center";
            spliceXorO(id);
            console.log("playing center");
        }
        else {
            var houseWins = (goForTheWin());
            if (!houseWins) {
                var defended = (defense());
                if (!defended) {
                    var goForWin = (goForTheWin());
                    if (!goForWin) {
                        var getTwo = (goForTwoInaRow());
                        if (!getTwo) {
                            var newRow = (startNewRow());
                            if (!newRow) {
                                playToaDraw();
                            }
                        }
                    }
                }
            }
        }
        id = "#" + id;
        $(id).html(image);
        makeReadyForNextPlayer(id);
    }

    $("#startover").click(function(){
        location.reload();
    });

    $("#auto").click(function(){
//        first reset the game board =================================================================
        $(".tile").on('click', tileClick);
        $(".tile").html("<img src='img/blank.png'>");
        id = "";
        gameboardArray = [
            ["upperRight", "center", "lowerLeft"],
            ["upperCenter", "center", "lowerCenter"],
            ["upperLeft", "upperCenter", "upperRight"],
            ["lowerLeft", "lowerCenter", "lowerRight"],
            ["upperLeft", "middleLeft", "lowerLeft"],
            ["upperRight", "middleRight", "lowerRight"],
            ["upperLeft", "center", "lowerRight"],
            ["middleLeft", "center", "middleRight"]
        ];
        gameStatusArray = [
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0
        ];
        xInARow = 0;
        oInARow = 0;
        tempArray = gameboardArray.map(function (arr) {
            return arr.slice();
        });
        tempStatusArray = gameStatusArray.slice();
//    start the autoplaying event ============================================================
        autoplaying = true;
        var whoGoesFirst = Math.floor(Math.random()*2.9);
        if (whoGoesFirst == 1){
            housePlay = "X";
            player = "O";
            playerX=true;
            playerO=false;
            $("#autoDraw").text("Dice roll says House is X and goes first.");
            $("#autoDraw").css("display", "inline");
            autoplay();
        }
        else{
            housePlay = "O";
            player = "X";
            playerX=true;
            playerO=false;
            $("#autoDraw").text("Dice roll says you are X and go first");
            $("#autoDraw").css("display", "inline");
        }

    });



</script>
</body>
</html>