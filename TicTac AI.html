<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TicTacToe</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <style type="text/css">
        #wholegame{
            height: 60em;
            width: 55em;
            background-color: burlywood;
            margin-left: 25%;
            margin-top: 5em;
            text-align: center;
        }
        .blank {
            height: 200px;
            width: 200px;
            background-color: bisque;
            border: solid .1em brown;
            display: inline-block;
        }
        .container{
            margin-left: -25%;
            margin-top: 1%;
            text-align: center;
        }
        button {
            height: 2.75em;
            width: 8em;
            margin-top: 1em;
            background-color: beige;
        }
        #winner{
            position: fixed;
            top: 25%;
            bottom: 0;
            left: 10%;
            right: 0;
            display: none;
            background-color: greenyellow;
            height: 2em;
            width: 80%;
            font-size: 4em;
        }
        #error{
            position: fixed;
            top: 25%;
            bottom: 0;
            left: 10%;
            right: 0;
            display: none;
            background-color: palevioletred;
            height: 2em;
            width: 80%;
            font-size: 4em;
        }
        #autoDraw{
            position: fixed;
            top: 25%;
            bottom: 0;
            left: 10%;
            right: 0;
            display: none;
            background-color: salmon;
            height: 2em;
            width: 80%;
            font-size: 4em;
        }
    </style>
</head>
<body>
<div id="wholegame">
    <div class="container">
        <div id="winner"></div>
        <div id="error"></div>
        <div id="autoDraw"></div>
        <h1>Tic Tac Toe</h1>
        <div class="row">
            <div id="upperLeft" class="tile blank"></div>
            <div id="upperCenter" class="tile blank"></div>
            <div id="upperRight" class="tile blank"></div>
        </div>
        <div class="row">
            <div id="middleLeft" class="tile blank"></div>
            <div id="center" class="tile blank"></div>
            <div id="middleRight" class="tile blank"></div>
        </div>
        <div class="row">
            <div id="lowerLeft" class="tile blank"></div>
            <div id="lowerCenter" class="tile blank"></div>
            <div id="lowerRight" class="tile blank"></div>
        </div>
        <button id="commit">Commit Play</button><br>
        <button id="auto">Play the House</button><br>
        <button id="startover">Start Over</button>

    </div>
</div>

<script
        src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
        crossorigin="anonymous">
</script>
<script>
    $(".tile").html("<img src='img/blank.png'>");
    var imageX = "<img src=\"img/x.png\">";
    var imageO = "<img src=\"img/O.png\">";
    var imageBlank = "<img src=\"img/blank.png\">";
    var id = "";
    var gameboardArray = [
        ["upperRight", "center", "lowerLeft"],
        ["upperCenter", "center", "lowerCenter"],
        ["upperLeft", "upperCenter", "upperRight"],
        ["lowerLeft", "lowerCenter", "lowerRight"],
        ["upperLeft", "middleLeft", "lowerLeft"],
        ["upperRight", "middleRight", "lowerRight"],
        ["upperLeft", "center", "lowerRight"],
        ["middleLeft", "center", "middleRight"]

    ];
    var gameStatusArray = [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
    ];
    var playerX = true;
    var playerO = false;
    var xInARow = 0;
    var oInARow = 0;
    var idToRevert = "";
    var XorO = "";
    var image = "";
    var housePlay = "";
    var player = "";
    var autoplaying = false
    function arrayTheSame(array, temp) {
        for (var i = 0; i < temp.length; i++) {
            for (var j = 0; j < temp[i].length; j++) {
                if (temp[i][j] != array[i][j]) {
                    idToRevert = array[i][j];
                    return false;
                    break;
                }
            }
        }
        return true;
    }

    var tempArray = gameboardArray.map(function (arr) {
        return arr.slice();
    });
    var tempStatusArray = gameStatusArray.slice();

    var noOtherChanges = "";
    var indexMarker = 0;
    function updateGameStatus (i, j){
        if (XorO==="X"){
            if (j===0){
                indexMarker = 1;
            }
            else if(j===1) {
                indexMarker = 3;
            }
            else {
                indexMarker = 9;
            }
        }
        else {
            if (j===0){
                indexMarker = -20;
            }
            else if(j===1) {
                indexMarker = -40;
            }
            else {
                indexMarker = -80;
            }
        }
        tempStatusArray[i] += indexMarker;
    }

    function spliceXorO(id) {
        for (var i = 0; i < tempArray.length; i++) {
            for (var j = 0; j < tempArray[i].length; j++) {
                if (tempArray[i][j] == id) {
                    tempArray[i].splice(j, 1, XorO);
                    updateGameStatus(i, j);
                }
            }
        }
    }
    function makeReadyForNextPlayer (id){
        xInARow = 0;
        oInARow = 0;
        gameboardArray = [];
        gameStatusArray = [];
        gameboardArray = tempArray.map(function (arr) {
            return arr.slice();
        });
        gameStatusArray = tempStatusArray.slice();

        $(id).unbind("click");

        if (!playerX) {
            playerX = true;
            playerO = false;
        }
        else {
            playerX = false;
            playerO = true;
        }
    }


    function doWeHaveAWinner () {
        for (var i = 0; i < tempArray.length; i++) {
            oInARow = 0;
            xInARow = 0;
            for (var j = 0; j < tempArray[i].length; j++) {
                if (tempArray[i][j] == "O") {
                    oInARow++;
                }
                if (tempArray[i][j] == "X") {
                    xInARow++;
                }
                if (oInARow == 3 || xInARow == 3) {
                    $("#winner").text(XorO + " WINS!!");
                    $("#winner").css("display", "inline");
                }
            }
        }
    }
    $("#auto").click(function(){
       autoplaying = true;
     var whoGoesFirst = Math.floor(Math.random()*2);
        if (whoGoesFirst == 1){
            housePlay = "X";
            player = "O";
            $("#autoDraw").text("Dice roll says House is X and goes first.");
            $("#autoDraw").css("display", "inline");
            setTimeout(autoplay, 3000);
        }
        else{
            housePlay = "O";
            player = "X";
            $("#autoDraw").text("Dice roll says you are X and go first");
            $("#autoDraw").css("display", "inline");
        }

    });

    $(".tile").click(function () {
        $("#winner").css("display", "none");
        $("#error").css("display", "none");
        $("#autoDraw").css("display", "none");

        XorO = "";

        if (playerX) {
            image = imageX;
            XorO = "X";
        }
        if (playerO) {
            image = imageO;
            XorO = "O";
        }
        noOtherChanges = arrayTheSame(gameboardArray, tempArray);

        if (!noOtherChanges) {

            idToRevert = "#" + idToRevert;
            $(idToRevert).html(imageBlank);
            tempArray = [];

            tempArray = gameboardArray.map(function (arr) {
                return arr.slice();
            });
            tempStatusArray = gameStatusArray.slice();

        }

        id = $(this).attr("id");
        spliceXorO(id); // splice the clicked tile into the temp Array
        $(this).html(image);
        doWeHaveAWinner();
    });


    $("#commit").click(function () {

        id = "#" + id;
        if ((id.indexOf("##") != -1) || arrayTheSame(gameboardArray, tempArray)) {
            $("#error").text("You must make a selection first");
            $("#error").css("display", "inline");
        }
        else {
            makeReadyForNextPlayer(id);
            if (autoplaying) {
                autoplay();
            }
        }
    });

    function defense() {
        if(housePlay==="X"){
            for (var d = 0; d < gameStatusArray.length; d++){
                console.log(gameStatusArray);
                if (gameStatusArray[d]== -120){  //play in i0
                    id = gameboardArray[d][0];
                    spliceXorO(id);
                    return true;
                    break;
                }
                else if (gameStatusArray[d] == -100){
                    console.log("100");
                    id = gameboardArray[d][1];
                    spliceXorO(id);
                    return true;
                    break;
                    //play in i1
                }
                else if (gameStatusArray[d]== -60){
                    id = gameboardArray[d][2];
                    spliceXorO(id);
                    return true;
                    break;
                    //play in i2
                }
            }
        }
        else {
            for (var d = 0; d < gameStatusArray.length; d++) {
                if (gameStatusArray[d] == 12) {
                    id = gameboardArray[d][0];
                    spliceXorO(id);
                    return true;
                    break;
                    // /play in i0
                }
                else if (gameStatusArray[d] == 10) {
                    //play in i1
                    id = gameboardArray[d][1];
                    spliceXorO(id);
                    return true;
                    break;
                }
                else if (gameStatusArray[d] == 4) {
                    //play in i2
                    id = gameboardArray[d][2];
                    spliceXorO(id);
                    return true;
                    break;
                }
            }
        }
        return false;
    }

    function goForTheWin () {
        if (housePlay === "X") {
            for (var i = 0; i < gameStatusArray.length; i++) {
                if (gameStatusArray[i] === 12) {  //play in i0
                    id = gameboardArray[i][0];
                    spliceXorO(id);
                    return true;
                    break;
                }
                if (gameStatusArray[i] === 10) {  //play in i1
                    id = gameboardArray[i][1];
                    spliceXorO(id);
                    return true;
                    break;
                }
                if (gameStatusArray[i] === 4) {  //play in i2
                    id = gameboardArray[i][2];
                    spliceXorO(id);
                    return true;
                    break;
                }
            }
        }
        else {
            for (var i = 0; i < gameStatusArray.length; i++) {
                if (gameStatusArray[i] === -120) {  //play in i0
                    id = gameboardArray[i][0];
                    spliceXorO(id);
                    return true;
                    break;
                }
                if (gameStatusArray[i] === -100) {  //play in i1
                    id = gameboardArray[i][1];
                    spliceXorO(id);
                    return true;
                    break;
                }
                if (gameStatusArray[i] === -60) {  //play in i2
                    id = gameboardArray[i][2];
                    spliceXorO(id);
                    return true;
                    break;
                }
            }
        }
        return false;
    }

    function goForTwoInaRow () {
        if (housePlay === "X") {
        for (var i = 0; i < gameStatusArray.length; i++) {
                if ((gameStatusArray[i] === 9) || (gameStatusArray === 3)) {  //play in i0
                    id = gameboardArray[i][0];
                    spliceXorO(id);
                    return true;
                    break;
                }
                if (gameStatusArray[i] === 1) {  //play in i2
                    id = gameboardArray[i][2];
                    spliceXorO(id);
                    return true;
                    break;
                }
            }
        }
    else {
        for (var i = 0; i < gameStatusArray.length; i++) {
            if ((gameStatusArray[i] === -80) || (gameStatusArray === -40)) {  //play in i0
                id = gameboardArray[i][0];
                spliceXorO(id);
                return true;
                break;
            }
            if (gameStatusArray[i] === -20) {  //play in i2
                id = gameboardArray[i][2];
                spliceXorO(id);
                return true;
                break;
            }
        }
    }
    return false;
    }

    function startNewRow () {
        for (var i = 0; i < gameStatusArray.length; i++) {
            if (gameStatusArray[i] === 0) {  //play in i0
                id = gameboardArray[i][0];
                spliceXorO(id);
                return true;
                break;
            }
        }
        return false;
    }

    function playToaDraw () {
        for (var i = 0; i < gameStatusArray.length; i++) {
            if ((gameStatusArray[i] === -77) || (gameboardArray[i]=== -31)) {  //play in i0
                id = gameboardArray[i][0];
                spliceXorO(id);
                return true;
                break;
            }
            if ((gameStatusArray[i] === -11) || (gameStatusArray === -79)) {  //play in i1
                id = gameboardArray[i][1];
                spliceXorO(id);
                return true;
                break;
            }
            if ((gameStatusArray[i] === -39) || (gameStatusArray === -17)) {  //play in i2
                id = gameboardArray[i][2];
                spliceXorO(id);
                return true;
                break;
            }
        }
    }

    function autoplay() {
        $("#autoDraw").css("display", "none");
        id="";
        if (housePlay=="X"){
            XorO = "X";
            image = imageX;
        }
        else if (housePlay == "O"){
            XorO = "O";
            image = imageO;
        }
        if (gameboardArray[0][1] === "center"){
            id = "center";
            spliceXorO(id);
        }
        else {
            var houseWins = (goForTheWin());
            if (houseWins) {
                doWeHaveAWinner();}
            else{
                var defended = (defense());
                console.log(defended);
                if (!defended) {
                    var getTwo = (goForTwoInaRow());
                    if (!getTwo) {
                        var newRow = (startNewRow());
                        if (!newRow) {
                            playToaDraw();
                        }
                    }
                }
            }
        }
        id="#"+id;
        console.log("id is "+ id);
        console.log(tempStatusArray);
        $(id).html(image);
        makeReadyForNextPlayer(id);
    }


    $("#startover").click(function(){
        location.reload();
    });

</script>
</body>
</html>