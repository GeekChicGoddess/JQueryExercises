<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Marker</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <style type="text/css">

        body {
            background-color: lightblue;
        }
        .container {
            margin-left: 5em;
            width: 100%!important;
        }

        h1, #map {
            margin-left: 18em;
        }
        select {
            margin-right: 1em;
            margin-left: 20em;
        }

        h2 {
            margin-left: 25em;
        }
        .checkbox {
            display: inline!important;
        }
        #forecastChange {
            margin-left: 1em;
        }
        .forecastDivs {
            background-color: lightgrey;
            height: 20em;
            display: inline-block;
            margin: 1em;
            padding-top: 0em;
            padding-left: 2.5em;
            border: solid .1em black;
            font-size: .7em;
        }
        img {
            margin-top: 0;
            margin-left: 1em;
        }
        h3 {
            font-size: 2em;
        }
        #temp{
            /*font-size: 2em;*/
            font-size: 1.5em;
            font-weight: bold;
        }
        .titles{
            font-weight: bold;
            margin-right: .5em;
        }

        #map {
            height: 25em;
            width: 74em;
            background-color: lightsteelblue;
            margin-bottom: 1.5em;
        }

        #lonlat {
            margin-left: 20em;
        }
        #lonLabel {
            margin-left: 3em;
        }
        #weatherButton {
            margin-left: 1em;
        }



    </style>
</head>
<body>
<div class="container-fluid">
    <h1>Weather Application</h1>
    <h2 id="cityName"></h2>
    <select name="daysForecast">
        <option value="10">Show 10 Days Forecast</option>
        <option value="9">Show 9 Days Forecast</option>
        <option value="8">Show 8 Days Forecast</option>
        <option value="7">Show 7 Days Forecast</option>
        <option value="6">Show 6 Days Forecast</option>
        <option value="5">Show 5 Days Forecast</option>
        <option value="4">Show 4 Days Forecast</option>
        <option value="3">Show 3 Days Forecast</option>
        <option value="2">Show 2 Days Forecast</option>
        <option value="1">Show 1 Day Forecast</option>
    </select>
    <label>Weather Display Options</label>
    <input  class="checkbox" type="checkbox" name="high" id="high"  checked> High Temp
    <input  class="checkbox" type="checkbox" name="low" id="low"  checked>Low Temp
    <input  class="checkbox" type="checkbox" name="windspeed" id="windspeed" checked> Windspeed
    <input  class="checkbox" type="checkbox" name="humidity" id="humidity" checked>Humidity
    <input  class="checkbox" type="checkbox" name="pressure" id="pressure"  checked>Pressure
    <input  class="checkbox" type="checkbox" name="icon" id="icon"  checked>Weather Icon
    <button id="forecastChange">Submit</button>
    <div class="container">
        <div id="forcastDivsContainer" class="d-flex flex-row">


        </div>
    </div>
    <div id="map"></div>
    <div id="lonlat">
        <label>Latitude</label><input id="lat" type="number" value="29.6708">
        <label id="lonLabel">Longitude</label><input id="lon" type="number" value="-98.4288268">
        <div id="addressInput"> <label>Input Address<input size="100px" type="text" id="findAddress"></label>
            <button id="weatherButton">Get Weather</button>
        </div>

    </div>

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDykvV2wJZcdlJ8pfHGv_iEgmPBQhqlggU"></script>
<script>
    $(document).ready(function(){
        var daysCount = 3;
        var lat = 29.4241;
        var lon = -98.4936;
        var weatherCenter = { lat: lat, lng: lon };
        var map;
        var mapDisplay = document.getElementById('map');
        var options = {
            zoom: 4,
            center: {
                lat: lat,
                lng: lon
            }
        };
        var counter = 0;
        var date = new Date();
        var day = (date.getDay());
        var dayArray =["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        function initMap() {

            map = new google.maps.Map(mapDisplay, options);

        }

        initMap();
        var marker = new google.maps.Marker({
            position: {
                lat: lat,
                lng: lon
            },
            map: map,
            draggable: true
        });

        $("#forecastChange").click(function(){
            for (var c = 0; c < daysCount; c++){
                id = "#forecast"+c;
                console.log(id);
                $(id).remove();
            }
            day = (date.getDay());
            daysCount = $('select[name=daysForecast]').val();
            getWeather();
            getCurrentWeather();
        });
        function getCurrentWeather () {
            $.get("http://api.openweathermap.org/data/2.5/weather", {
                APPID: "cf5050c0c4303753a04239e865a2dd5c",
                lat: lat,
                lon: lon,
                units: "imperial"
            }).done(function (data) {
                var currenttemp = Math.floor(data.main.temp);
                var contentString = "<img src='http://openweathermap.org/img/w/" + data.weather[0].icon + ".png'>Current Temperature: "+currenttemp + "&deg;"+ "<br>Current Conditions: "+ data.weather[0].description +"";
                var infowindow = new google.maps.InfoWindow({
                    content: contentString
                });
                infowindow.open(map, marker);
            });
        }

        function getWeather () {
            $.get("http://api.openweathermap.org/data/2.5/forecast/daily", {
                APPID: "cf5050c0c4303753a04239e865a2dd5c",
                lat: lat,
                lon: lon,
                units: "imperial",
                cnt: daysCount
            }).done(function (data) {
                counter = 0;
                data.list.forEach(function (i) {
                    if (day==7){
                        day=0;
                    }
                var forecastFill = "";
                forecastFill += "<div id='forecast"+counter+"' class='forecastDivs flex'>";
                forecastFill += "<p><h3>"+dayArray[day]+"</h3></p>";
                if($("#high").prop('checked') == true){
                    forecastFill += "<p id='temp'>" + parseInt(i.temp.day) + "&deg;";}
                if($("#low").prop('checked') == true){
                    forecastFill += "/" + parseInt(i.temp.night) + "&deg;";}
                if($("#icon").prop('checked') == true){
                    forecastFill += "<img src='http://openweathermap.org/img/w/" + i.weather[0].icon + ".png'></p>";}
                forecastFill += "<p><span class='titles'>" + i.weather[0].main + ":</span>  " + i.weather[0].description + "</p>";
                if($("#humidity").prop('checked') == true){
                    forecastFill += "<p><span class='titles'> Humidity:</span>   " + i.humidity + "</p>";}
                if($("#wind").prop('checked') == true){
                    forecastFill += "<p><span class='titles'>Wind: </span>  " + i.speed + "</p>";}
                if($("#pressure").prop('checked') == true){
                    forecastFill += "<p><span class='titles'>Pressure: </span>  " + i.pressure + "</p><div>";}
//                    var id = "#forecast" + counter;
                $("#forcastDivsContainer").append(forecastFill);
                counter++;
                day++
            });
            var cityName = data.city.name;
            $("#cityName").text(cityName);
            if (daysCount == 1) {
                $(".flex-row").css("margin-left", "40em");
            }
            else if (daysCount==2) {
                $(".flex-row").css("margin-left", "35em");
            }
            else if (daysCount==3) {
                $(".flex-row").css("margin-left", "28em");
            }
            else if (daysCount==4) {
                $(".flex-row").css("margin-left", "25em");
            }
            else if (daysCount==5) {
                $(".flex-row").css("margin-left", "19em");
            }
            else if (daysCount==6) {
                $(".flex-row").css("margin-left", "14em");
            }
            else if (daysCount==7) {
                $(".flex-row").css("margin-left", "8em");
            }
            else if (daysCount==8) {
                $(".flex-row").css("margin-left", "1em");
            }
            else if (daysCount==9) {
                $(".flex-row").css("margin-left", "-2em");
            }
            else {
                $(".flex-row").css("margin-left", "-8em");
                $(".flex-row").css("margin-right", "-5em");
            }
        }).fail(function (data) {
        console.log(data.statusText);
    });
    }
    getWeather();
    getCurrentWeather();


    marker.addListener('dragend', function(event){
//        lat = marker.getPosition().lat();
//        lon = marker.getPosition().lng();
        for (var c = 0; c < daysCount; c++){
            id = "#forecast"+c;
            console.log(id);
            $(id).remove();
        }
        day = (date.getDay());
        lat = event.latLng.lat();
        lon = event.latLng.lng();
        options.center.lng = lon;
        options.center.lat = lat;
        getWeather();
        getCurrentWeather();

    });

    $("#weatherButton").click(function(){
        for (var c = 0; c < daysCount; c++){
            id = "#forecast"+c;
            console.log(id);
            $(id).remove();
        }
        day = (date.getDay());
        var address = $("#findAddress").val();
        if (address == "") {
            lat = parseFloat($("#lat").val());
            lon = parseFloat($("#lon").val());
            weatherCenter = {lat: lat, lng: lon};
            options.center.lat = lat;
            options.center.lng = lon;
            getWeather();
            marker.setPosition({lat: lat, lng: lon});
            getCurrentWeather();

        }
        else {
            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({ "address": address }, function(results, status) {
                console.log(results);
                if (status == google.maps.GeocoderStatus.OK) {
                    map.setCenter(results[0].geometry.location);
                    lat = results[0].geometry.location.lat();
                    lon =  results[0].geometry.location.lng();
                    options.center.lat = lat;
                    options.center.lng = lon;
                    getWeather();
                    marker.setPosition({lat: lat, lng: lon})
                    getCurrentWeather();
                } else {
                    alert("Geocoding was not successful - STATUS: " + status);
                }
            });
        }

    })


    });
</script>
</body>
</html>